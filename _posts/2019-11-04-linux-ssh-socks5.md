---
layout: post
title: ssh端口转发和socks代理
categories: [编程, linux]
tags: [ssh, socks5]
---


> 公司有一堆服务器无法直接访问，但是提供了一台跳板机，所以需要通过代理来访问其它服务器

#### 1. 端口转发

需要访问指定服务器的某一端口，可以通过跳板机做端口转发

```java
$ ssh -CNfL 18828:192.168.1.101:8828 root@192.168.1.100
```

> 在跳板机上启用`18828`端口，转发到`192.168.1.101:8828`，便可以通过跳板机的`18828`端口访问了

#### 2. 反向隧道

A可ssh到B，但B无法访问A

```
A: 192.168.1.100
B: 120.25.111.202
```

通过ssh映射把A的8081端口映射到B的8080端口

```
ssh -gfNTR 120.25.111.202:8080:192.168.1.100:8081 120.25.111.202
```

#### 3. 动态转发

需要访问不同服务器的不同端口，可以通过跳板机做`socks`代理

```java
$ ssh -CNf -D 28828 root@192.168.1.100
```

> 在跳板机上启用了一个`socks5`代理，端口为`28828`，这样本地就可能通过配置这个代理，访问其它服务器的任意端口了

#### 4. 参数说明

* `-C`: 启用压缩
* `-N`: 不执行远程命令
* `-f`: 后台运行
* `-D`: 本地动态转发绑定地址，`[bind_address:]port`
* `-L`: 端口转发规则，`[bind_address:]port:host:hostport`
* `-g`: 允许远程主机连接本地转发的端口
* `-R`: 映射远程主机端口到本地主机端口，`[bind_address:]port:host:hostport`

> 更多参考`man ssh`