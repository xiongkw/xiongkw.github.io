---
layout: post
title: 关于微服务架构中服务调用rpc和restful
categories: [编程, java, spring]
tags: [spring cloud,dubbo, rpc, restful]
---


> 在`java`的微服务架构中，服务之间调用通常使用`rpc`

#### 1. 背景

微服务架构中，服务`提供方`通常要提供一个`接口`供服务`消费方`来调用，这里所说的接口是一个抽象的概念，并不是指`java`的`interface`，例如最常见的两种形式`rpc`和`restful`，其实就是`java`的`interface`和`http`

* `restful`本是基于`http`的一种具体协议，在开发中表现为需要自己写`http`调用代码，并处理`序列化`和`反序列化`，其实加上`序列化`和`反序列化`后就是`rpc`
* `rpc`是从代码层面的`方法调用`来说的，简单来说就是`A线程`调用`B方法`，它不管底层到底是基于何种`通信协议`

> 其实`rpc`和`restful`并不冲突，前者是代码层面的`方法调用`，而后者是`通信协议`，而`rpc`也可以基于`restful`

#### 2. Restful

工程结构：
```
service1

service2
```

> 服务之间通过`http`协议调用，没有代码依赖

#### 3. RPC

典型的特征是有一个独立的`api`，其中会包含`interface`和`DTO`：

```
api
    |-Interface1
    |-DTO1
    
service1

service2
```

> 服务之间通过`api`调用，需要依赖`api`代码

#### 4. 对比

|          |   restful  |  rpc |
| -------- | -------------------| ------------------------------ |
|代表    |   spring cloud         |     dubbo         |
|耦合性    |   松散         |     强依赖api        |
|编码复杂度    |   高，需要处理http协议以及序列化     |     低，依赖api         |
|代码重用    |   客户端自己维护，可重用性低         |     服务端提供api，可重用        |
|协议可扩展性    |   只能基于http         |     协议无关，可根据业务场景选择最优协议    |
|维护复杂度  |   客户端维护api         |     服务端维护api         |

#### 5. 总结

`restful`方式是面向协议，`rpc`方式是面向`api`，二者各有优缺点，这里不讲大道理，只用实际项目经验说话。本文更推荐`restful`，原因如下：

* `强依赖问题`: 实际项目中因为`rpc`的强依赖性和微服务架构的分散性，往往在升级`api`后会引起一串连锁反应，例如反序列化(`java serialize、kryo...`)要求对象的`版本`一致，导致其它无关紧要的客户端都要升级依赖并重新部署

* `api可维护性`:`rpc`的封装性会导致`api`越来越复杂，例如有开发经验不足的同事为了省事，会在`DTO`里加入许多不必要且不合理的属性，导致接口越来越复杂，而`restful`基于`http`的简单性，则相对好一些

> 关于`rpc`和`restful`的争论已久，以上纯属个人观点