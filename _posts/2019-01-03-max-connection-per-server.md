---
layout: post
title: 浏览器最大并发连接数
categories: [编程, web]
tags: [http, browser]
---


> `2019`年刚开始就连续通宵两晚为客户排查线上故障，现在还是头晕晕，人老了，吃不消啊

#### 1. 问题描述

客户使用我们的`DevOps`平台开发了一个`web`系统，使用中经常碰到页面加载很慢，在`chrome`调试中看到有的资源文件(`10k`)加载时间竟然高达`1m`

#### 2. 问题排查

第一反应是排查我们的平台，想法是好的(`有问题先自查嘛`)

首先是通过压力测试重现问题，各种压力测试(压`nginx`，压`docker`...)，竟然无法重现

从内核参数到`nginx`再到`docker`、`微服务`、`db`、`jvm`，各路大牛，各显神通

最后一大牛找发现了一个现象：每次页面加载不出来时，`chrome`调试工具中都能看到有`6`个请求一直在`pending`

到此才找到了原因：页面中有一个定时器不停的发送请求，而这个请求非常慢(`客户程序的问题，不深究了`)，一直处于`pending`状态，当`pending`的请求数达到浏览器并发上限后，后面所有请求都会被阻塞

去掉定时器逻辑，问题解决

#### 3. 总结

* 故障排查最重要的还是找对方法，比如我们一开始就以为是平台或者后端服务的问题，所以花了大量时间对后端做压力测试和性能调优，最后才发现问题出在前端(`当然后端服务响应慢也是主要原因`)
* 一个优秀的程序员真的顶得过三个毕业生，所以不要总是在技术上抠成本(`吐槽一下客户的开发团队和那些目光短浅的老板们`)

#### 4. 关于浏览器并发数

一般也叫`max connections per server`，意思是浏览器对`同一个服务端`发起请求的`最大连接数`

#### 5. 主流浏览器的并发数

| Browser | HTTP/1.1 | HTTP/1.0 |
| ------------------------- | -------------------| ------------------------------ |
| Chrome 4+ | 6 | 6 |
| Safari 3,4 | 4 | 4 |
| Firefox | 6 | 6 |
| Opera 10.51+ | 8 | ? |
| IE 8,10,11 | 6 | 6 |
| IE 9 | 10 | 10 |
| IE 6,7 | 2 | 4 |